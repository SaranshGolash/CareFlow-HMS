<%- include('initials/header.ejs', { title: 'Admin Analytics' }) %>
<link rel="stylesheet" href="/styles/admin_analytics.css">
    <div class="container py-5">
        <h2 class="mb-4 text-primary"><i class="fas fa-chart-line me-3"></i> Management Analytics</h2>
        <p class="lead text-muted mb-5">Actionable insights across patient accounts, appointments, and billing.</p>

        <h3 class="mb-3 text-dark">Financial Overview</h3>
        <div class="row g-4 mb-5">
            
            <div class="col-md-4">
                <div class="analytics-card card h-100 shadow-sm bg-light-green">
                    <div class="card-body">
                        <i class="fas fa-dollar-sign fa-2x text-success mb-2"></i>
                        <p class="text-uppercase text-muted mb-0 small">Total Billed</p>
                        <h4 class="fw-bold">$<%= totalBilled %></h4>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="analytics-card card h-100 shadow-sm bg-light-blue">
                    <div class="card-body">
                        <i class="fas fa-hand-holding-usd fa-2x text-primary mb-2"></i>
                        <p class="text-uppercase text-muted mb-0 small">Total Collected</p>
                        <h4 class="fw-bold">$<%= totalCollected %></h4>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="analytics-card card h-100 shadow-sm bg-light-red">
                    <div class="card-body">
                        <i class="fas fa-exclamation-circle fa-2x text-danger mb-2"></i>
                        <p class="text-uppercase text-muted mb-0 small">Total Outstanding</p>
                        <h4 class="fw-bold">$<%= totalOutstanding %></h4>
                    </div>
                </div>
            </div>
            
        </div>
        
        <h3 class="mb-3 text-dark">Operational Readiness</h3>
        <div class="row g-4">
            
            <div class="col-md-6">
                <div class="analytics-card card h-100 shadow-sm p-3">
                    <h5 class="text-primary mb-3">User Base Summary</h5>
                    <ul class="list-group list-group-flush small">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Total Patients (<%= userStats.user %>)
                            <span class="badge bg-primary rounded-pill"><%= userStats.user %></span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Total Admins/Staff (<%= userStats.admin %>)
                            <span class="badge bg-secondary rounded-pill"><%= userStats.admin %></span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center fw-bold">
                            Total Registered Users
                            <span class="badge bg-dark rounded-pill"><%= userStats.user + userStats.admin %></span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="analytics-card card h-100 shadow-sm p-3">
                    <h5 class="text-primary mb-3">Inventory Alert Status</h5>
                    <div class="d-flex align-items-center justify-content-between p-3 bg-<%= lowStockCount > 0 ? 'danger' : 'success' %>-light rounded">
                        <span class="fs-5 fw-bold text-<%= lowStockCount > 0 ? 'danger' : 'success' %>">
                            <i class="fas fa-<%= lowStockCount > 0 ? 'times-circle' : 'check-circle' %> me-2"></i> 
                            <%= lowStockCount > 0 ? 'URGENT REPLENISHMENT' : 'Stock Levels OK' %>
                        </span>
                        <span class="badge bg-<%= lowStockCount > 0 ? 'danger' : 'success' %> fs-6"><%= lowStockCount %></span>
                    </div>
                    <div class="mt-3 text-end">
                        <a href="/inventory" class="btn btn-sm btn-outline-primary">Manage Inventory</a>
                    </div>
                </div>
            </div>
            
        </div>

        <h3 class="mb-3 mt-5 text-dark">Appointment Status Breakdown</h3>
        <div class="table-responsive shadow-sm analytics-table-container">
            <table class="table table-striped table-hover mb-0">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th class="text-end">Count</th>
                        <th class="text-end">Percentage of Total</th>
                    </tr>
                </thead>
                <tbody>
                    <% 
                        const totalAppts = Object.values(apptStats).reduce((sum, count) => sum + count, 0);
                        const displayStatus = (status, count, color) => `
                            <tr>
                                <td><span class="badge bg-${color}">${status}</span></td>
                                <td class="text-end fw-bold">${count}</td>
                                <td class="text-end">${totalAppts > 0 ? ((count / totalAppts) * 100).toFixed(1) : 0}%</td>
                            </tr>
                        `;
                    %>
                    <%- displayStatus('Completed', apptStats.Completed, 'success') %>
                    <%- displayStatus('Confirmed (Future)', apptStats.Confirmed, 'primary') %>
                    <%- displayStatus('Pending (Unconfirmed)', apptStats.Pending, 'warning') %>
                    <%- displayStatus('Canceled', apptStats.Canceled, 'danger') %>
                    
                    <tr class="fw-bold bg-light">
                        <td>TOTAL APPOINTMENTS</td>
                        <td class="text-end"><%= totalAppts %></td>
                        <td class="text-end">100.0%</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
    </div>
<%- include('initials/footer.ejs') %>