<%- include('initials/header.ejs', { title: 'Manage Schedule' }) %>
<link rel="stylesheet" href="/styles/admin_staff.css">
    <div class="container py-5">
        <h2 class="mb-2 text-primary">Manage Schedule</h2>
        <p class="lead text-muted mb-4">Set weekly availability for <strong>Dr. <%= doctor.username %></strong></p>

        <div class="row g-4">
            <div class="col-lg-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white fw-bold">Add New Slot</div>
                    <div class="card-body">
                        <form action="/admin/schedule" method="POST">
                            <input type="hidden" name="doctor_id" value="<%= doctor.id %>">
                            <div class="mb-3">
                                <label for="day_of_week" class="form-label">Day of Week</label>
                                <select id="day_of_week" name="day_of_week" class="form-select" required>
                                    <option value="1">Monday</option>
                                    <option value="2">Tuesday</option>
                                    <option value="3">Wednesday</option>
                                    <option value="4">Thursday</option>
                                    <option value="5">Friday</option>
                                    <option value="6">Saturday</option>
                                    <option value="0">Sunday</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="start_time" class="form-label">Start Time</label>
                                <input type="time" id="start_time" name="start_time" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="end_time" class="form-label">End Time</label>
                                <input type="time" id="end_time" name="end_time" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Add Slot</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="table-responsive shadow-sm">
                    <table class="table table-hover table-striped mb-0">
                        <thead>
                            <tr>
                                <th>Day</th>
                                <th>Start Time</th>
                                <th>End Time</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]; %>
                            <% if (schedule.length > 0) { %>
                                <% schedule.forEach(s => { %>
                                    <tr>
                                        <td><%= days[s.day_of_week] %></td>
                                        <td><%= new Date('1970-01-01T' + s.start_time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) %></td>
                                        <td><%= new Date('1970-01-01T' + s.end_time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) %></td>
                                        <td class="text-center">
                                            <form action="/admin/schedule/<%= s.schedule_id %>?_method=DELETE" method="POST">
                                                <input type="hidden" name="doctor_id" value="<%= doctor.id %>">
                                                <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                            </form>
                                        </td>
                                    </tr>
                                <% }); %>
                            <% } else { %>
                                <tr><td colspan="4" class="text-center">No schedule set for this doctor.</td></tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
<%- include('initials/footer.ejs') %>